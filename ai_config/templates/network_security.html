{% extends './layout/layout1.html' %}
{% block style %}

<style>
    /* Import Google Font */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

    .alert { animation: fadeIn 0.5s; }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
        border: 2px solid white;
        box-shadow: 0 0 5px rgba(0,0,0,0.2);
    }
    
    .status-connected { background-color: #48bb78; } /* Green */
    .status-disconnected { background-color: #f56565; } /* Red */
    
    .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
    }
    
    .btn:hover {
        opacity: 0.9;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-tabs .nav-link {
        border-bottom: 2px solid transparent !important;
        margin-bottom: -2px;
        transition: all 0.2s ease-in-out;
    }

    .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
        color: #2b6cb0 !important;
        background-color: transparent !important;
        border-color: transparent transparent #2b6cb0 transparent !important;
        font-weight: 600 !important;
    }

    .nav-tabs .nav-link:hover {
        border-color: transparent transparent #a0aec0 transparent !important;
        color: #2d3748 !important;
    }

</style>


{% endblock %}
{% block content %}
<div class="rbt-main-content mr--0" style="background-color: #f8f9fa; font-family: 'Poppins', sans-serif;">
    <div class="rbt-daynamic-page-content">
        
        <div class="rbt-dashboard-content" style="padding: 30px;">
            
            <div class="row mb-5" style="display: flex; align-items: center; justify-content: space-between;">
                <div class="col-md-6">
                    <h3 style="color: #1a202c; font-weight: 600;">Network & Security</h3>
                    <p style="color: #718096;">Real-time monitoring and threat management dashboard.</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="navbar-text" style="display: flex; align-items: center; justify-content: flex-end;">
                        <span class="status-indicator" id="connectionStatus" style="transition: background-color 0.3s ease;"></span>
                        <span id="connectionText" style="color: #4a5568; font-weight: 500;">Connecting...</span>
                    </div>
                </div>
            </div>
          
            <div class="container-fluid mt-4 px-0">
                <div id="alertContainer"></div>

                <div class="row mb-4">
                    <div class="col-md-3 mb-4">
                        <div class="card stats-card" style="background-color: #ffffff; border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); transition: all 0.3s ease;">
                            <div class="card-body" style="padding: 25px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h4 id="totalBlocked" style="color: #e53e3e; font-weight: 700; margin-bottom: 5px;">{{ total_blocked }}</h4>
                                        <p class="card-text" style="color: #718096; margin: 0;">Total Blocked</p>
                                    </div>
                                    <div class="align-self-center" style="color: #e53e3e; opacity: 0.7;">
                                        <i class="fas fa-ban fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card stats-card" style="background-color: #ffffff; border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); transition: all 0.3s ease;">
                            <div class="card-body" style="padding: 25px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h4 id="activeBlocks" style="color: #dd6b20; font-weight: 700; margin-bottom: 5px;">{{ active_blocks }}</h4>
                                        <p class="card-text" style="color: #718096; margin: 0;">Active Blocks</p>
                                    </div>
                                    <div class="align-self-center" style="color: #dd6b20; opacity: 0.7;">
                                        <i class="fas fa-shield-alt fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card stats-card" style="background-color: #ffffff; border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); transition: all 0.3s ease;">
                            <div class="card-body" style="padding: 25px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h4 id="recentAlerts" style="color: #3182ce; font-weight: 700; margin-bottom: 5px;">0</h4>
                                        <p class="card-text" style="color: #718096; margin: 0;">Recent Alerts</p>
                                    </div>
                                    <div class="align-self-center" style="color: #3182ce; opacity: 0.7;">
                                        <i class="fas fa-exclamation-triangle fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card stats-card" style="background-color: #ffffff; border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); transition: all 0.3s ease;">
                            <div class="card-body" style="padding: 25px;">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <h4 id="totalLogs" style="color: #38a169; font-weight: 700; margin-bottom: 5px;">0</h4>
                                        <p class="card-text" style="color: #718096; margin: 0;">Total Logs</p>
                                    </div>
                                    <div class="align-self-center" style="color: #38a169; opacity: 0.7;">
                                        <i class="fas fa-file-alt fa-2x"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row mb-5">
                    <div class="col-md-6 mb-4">
                        <div class="card" style="border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <div class="card-header" style="background-color: #fff; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <h5 style="color: #2d3748; font-weight: 600; margin: 0;"><i class="fas fa-ban me-2" style="color: #c53030;"></i>Manual Block IP</h5>
                            </div>
                            <div class="card-body" style="padding: 25px;">
                                <form id="manualBlockForm">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="blockIpAddress" placeholder="IP Address" required style="border-radius: 8px; border: 1px solid #cbd5e0; padding: 10px;">
                                    </div>
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="blockReason" placeholder="Reason" style="border-radius: 8px; border: 1px solid #cbd5e0; padding: 10px;">
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="permanentBlock" style="border-radius: 4px;">
                                            <label class="form-check-label" for="permanentBlock" style="color: #4a5568;">
                                                Permanent Block
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn" style="background-color: #e53e3e; color: white; border-radius: 8px; padding: 10px 20px; font-weight: 500; border: none; transition: background-color 0.3s ease;">
                                        <i class="fas fa-ban me-1"></i> Block IP
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card" style="border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <div class="card-header" style="background-color: #fff; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <h5 style="color: #2d3748; font-weight: 600; margin: 0;"><i class="fas fa-check-circle me-2" style="color: #38a169;"></i>Add to Whitelist</h5>
                            </div>
                            <div class="card-body" style="padding: 25px;">
                                <form id="whitelistForm">
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="whitelistIpAddress" placeholder="IP Address" required style="border-radius: 8px; border: 1px solid #cbd5e0; padding: 10px;">
                                    </div>
                                    <div class="mb-3">
                                        <input type="text" class="form-control" id="whitelistDescription" placeholder="Description" style="border-radius: 8px; border: 1px solid #cbd5e0; padding: 10px;">
                                    </div>
                                    <button type="submit" class="btn" style="background-color: #38a169; color: white; border-radius: 8px; padding: 10px 20px; font-weight: 500; border: none; transition: background-color 0.3s ease;">
                                        <i class="fas fa-plus me-1"></i> Add to Whitelist
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <ul class="nav nav-tabs" id="myTab" role="tablist" style="border-bottom: 2px solid #e2e8f0;">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="blocked-tab" data-bs-toggle="tab" data-bs-target="#blocked" type="button" style="border: none; color: #4a5568; font-weight: 500;">
                            <i class="fas fa-ban me-1"></i> Blocked IPs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="suricata-tab" data-bs-toggle="tab" data-bs-target="#suricata" type="button" style="border: none; color: #4a5568; font-weight: 500;">
                            <i class="fas fa-shield-alt me-1"></i> Suricata Logs
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="whitelist-tab" data-bs-toggle="tab" data-bs-target="#whitelist" type="button" style="border: none; color: #4a5568; font-weight: 500;">
                            <i class="fas fa-check-circle me-1"></i> Whitelisted IPs
                        </button>
                    </li>
                </ul>

                <div class="tab-content" id="myTabContent" style="padding-top: 20px;">
                    <div class="tab-pane fade show active" id="blocked" role="tabpanel">
                        <div class="card" style="border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <div class="card-header" style="background-color: #fff; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <h5 style="color: #2d3748; font-weight: 600; margin: 0;">Recently Blocked IPs</h5>
                            </div>
                            <div class="card-body">
                                <div id="blockedIpsList">
                                    {% for blocked_ip in blocked_ips %}
                                    <div class="blocked-ip-item" data-ip="{{ blocked_ip.ip_address }}" style="padding: 15px; margin: 10px 0; border-left: 4px solid #e53e3e; background-color: #fff5f5; border-radius: 0 8px 8px 0;">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong style="color: #2d3748;">{{ blocked_ip.ip_address }}</strong><br>
                                                <small class="text-muted" style="color: #718096 !important;">{{ blocked_ip.reason }}</small><br>
                                                <small class="text-muted" style="color: #a0aec0 !important;">{{ blocked_ip.blocked_at|date:"Y-m-d H:i:s" }}</small>
                                            </div>
                                            <div>
                                                {% if blocked_ip.is_permanent %}
                                                    <span class="badge" style="background-color: #c53030; color: white; padding: 5px 10px; border-radius: 12px;">Permanent</span>
                                                {% else %}
                                                    <span class="badge" style="background-color: #dd6b20; color: white; padding: 5px 10px; border-radius: 12px;">Temporary</span>
                                                {% endif %}
                                                <button class="btn btn-sm ms-2" onclick="unblockIP('{{ blocked_ip.ip_address }}')" style="border: 1px solid #38a169; color: #38a169; border-radius: 8px; font-weight: 500;">
                                                    <i class="fas fa-unlock"></i> Unblock
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="suricata" role="tabpanel">
                        <div class="card" style="border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <div class="card-header" style="background-color: #fff; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <h5 style="color: #2d3748; font-weight: 600; margin: 0;">Recent Suricata Alerts</h5>
                            </div>
                            <div class="card-body">
                                <div id="suricataLogsList">
                                    {% for log in suricata_logs %}
                                    <div class="alert" style="background-color: #fffaf0; border-left: 4px solid #dd6b20; border-radius: 0 8px 8px 0;">
                                        <div class="d-flex justify-content-between">
                                            <div>
                                                <strong style="color: #2d3748;">{{ log.source_ip }}</strong> → {{ log.destination_ip }}<br>
                                                <small style="color: #718096;">{{ log.message }}</small><br>
                                                <small class="text-muted" style="color: #a0aec0 !important;">{{ log.timestamp|date:"Y-m-d H:i:s" }} | Priority: {{ log.priority }}</small>
                                            </div>
                                            <div>
                                                {% if log.classification %}
                                                <span class="badge" style="background-color: #c53030; color: white; padding: 5px 10px; border-radius: 12px;">{{ log.classification }}</span>
                                                {% endif %}
                                                <button class="btn btn-sm ms-2" onclick="quickBlock('{{ log.source_ip }}', 'Suricata Alert')" style="background-color: #c53030; color: white; border: none; border-radius: 8px; font-weight: 500;">
                                                    <i class="fas fa-ban"></i> Block
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="whitelist" role="tabpanel">
                        <div class="card" style="border-radius: 12px; border: none; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);">
                            <div class="card-header" style="background-color: #fff; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <h5 style="color: #2d3748; font-weight: 600; margin: 0;">Whitelisted IPs</h5>
                            </div>
                            <div class="card-body">
                                <div id="whitelistedIpsList">
                                    {% for whitelist in whitelisted_ips %}
                                    <div class="alert" style="background-color: #f0fff4; border-left: 4px solid #38a169; border-radius: 0 8px 8px 0;">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <strong style="color: #2d3748;">{{ whitelist.ip_address }}</strong><br>
                                                <small style="color: #718096;">{{ whitelist.description }}</small><br>
                                                <small class="text-muted" style="color: #a0aec0 !important;">Added: {{ whitelist.added_at|date:"Y-m-d H:i:s" }}</small>
                                            </div>
                                            <span class="badge" style="background-color: #38a169; color: white; padding: 5px 10px; border-radius: 12px;">Protected</span>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
{% block script %}
    <script>
        class SecurityMonitor {
            constructor() {
                this.ws = null;
                this.reconnectAttempts = 0;
                this.maxReconnectAttempts = 5;
                this.reconnectInterval = 5000;
                
                this.init();
            }
            
            init() {
                this.connectWebSocket();
                this.setupEventListeners();
                this.startStatsUpdater();
            }
            
            connectWebSocket() {
                const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                const wsUrl = `${protocol}//${window.location.host}/ws/security/`;
                
                try {
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = (event) => {
                        console.log('WebSocket connected');
                        this.updateConnectionStatus(true);
                        this.reconnectAttempts = 0;
                    };
                    
                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                      
                    };
                    
                    this.ws.onclose = (event) => {
                        console.log('WebSocket disconnected');
                        this.updateConnectionStatus(false);
                        this.attemptReconnect();
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                        this.updateConnectionStatus(false);
                    };
                    
                } catch (error) {
                    console.error('Failed to connect WebSocket:', error);
                    this.updateConnectionStatus(false);
                    this.attemptReconnect();
                }
            }
            
            handleWebSocketMessage(data) {
                switch (data.type) {
                    case 'initial_data':
                        this.handleInitialData(data.data);
                        break;
                    case 'ip_blocked':
                        this.handleIPBlocked(data.data);
                        break;
                    case 'new_log':
                        this.handleNewLog(data.data);
                        break;
                    case 'whitelist_skip':
                        this.handleWhitelistSkip(data.data);
                        break;
                    case 'security_stats': // ← tambahkan ini
                        this.handleSecurityStats(data.data);
                        break;
                    default:
                        console.log('Unknown message type:', data.type);
                }
            }
            
            handleInitialData(data) {
                console.log('Initial data received:', data);
                // Update blocked IPs list if needed
                // Update recent logs if needed
            }
            
            handleIPBlocked(data) {
                this.showAlert('danger', `🚫 IP ${data.ip} has been blocked!`);
                this.addBlockedIPToList(data); 
                this.updateStats();
                this.playNotificationSound();
            }
            
            handleNewLog(data) {
                this.showAlert('warning', `⚠️ New security alert from ${data.ip}`);
                this.addSuricataLogToList(data);
            }
            
            handleWhitelistSkip(data) {
                this.showAlert('info', `ℹ️ Whitelisted IP ${data.ip} detected but not blocked`);
            }
            
            addBlockedIPToList(data) {
                const blockedList = document.getElementById('blockedIpsList');
                const newItem = document.createElement('div');
                newItem.className = 'blocked-ip-item new-alert';
                newItem.setAttribute('data-ip', data.ip);
                
                newItem.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong>${data.ip}</strong>
                            <br>
                            <small class="text-muted">${data.reason}</small>
                            <br>
                            <small class="text-muted">${new Date(data.timestamp).toLocaleString()}</small>
                        </div>
                        <div>
                            <span class="badge ${data.permanent ? 'bg-danger' : 'bg-warning'}">
                                ${data.permanent ? 'Permanent' : 'Temporary'}
                            </span>
                            <button class="btn btn-sm btn-outline-success ms-2" onclick="unblockIP('${data.ip}')">
                                <i class="fas fa-unlock"></i> Unblock
                            </button>
                        </div>
                    </div>
                `;
                
                blockedList.insertBefore(newItem, blockedList.firstChild);
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    newItem.classList.remove('new-alert');
                }, 1000);
            }
            
            addSuricataLogToList(data) {
                const logsList = document.getElementById('suricataLogsList');
                const newItem = document.createElement('div');
                newItem.className = 'alert alert-warning new-alert';
                
                newItem.innerHTML = `
                    <div class="d-flex justify-content-between">
                        <div>
                            <strong>${data.ip}</strong>
                            <br>
                            <small>${data.message}</small>
                            <br>
                            <small class="text-muted">${new Date(data.timestamp).toLocaleString()} | Priority: ${data.priority}</small>
                        </div>
                        <div>
                            ${data.classification ? `<span class="badge bg-danger">${data.classification}</span>` : ''}
                            <button class="btn btn-sm btn-danger ms-2" onclick="quickBlock('${data.ip}', 'Real-time Alert')">
                                <i class="fas fa-ban"></i> Block
                            </button>
                        </div>
                    </div>
                `;
                
                logsList.insertBefore(newItem, logsList.firstChild);
                
                setTimeout(() => {
                    newItem.classList.remove('new-alert');
                }, 1000);
            }
            
            showAlert(type, message) {
                const alertContainer = document.getElementById('alertContainer');
                const alert = document.createElement('div');
                alert.className = `alert alert-${type} alert-dismissible fade show`;
                alert.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                alertContainer.appendChild(alert);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 5000);
            }
            
            updateConnectionStatus(connected) {
                const indicator = document.getElementById('connectionStatus');
                const text = document.getElementById('connectionText');
                
                if (connected) {
                    indicator.className = 'status-indicator status-connected';
                    text.textContent = 'Connected';
                } else {
                    indicator.className = 'status-indicator status-disconnected';
                    text.textContent = 'Disconnected';
                }
            }
            
            attemptReconnect() {
                if (this.reconnectAttempts < this.maxReconnectAttempts) {
                    this.reconnectAttempts++;
                    console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`);
                    
                    setTimeout(() => {
                        this.connectWebSocket();
                    }, this.reconnectInterval);
                } else {
                    console.log('Max reconnection attempts reached');
                    document.getElementById('connectionText').textContent = 'Connection Failed';
                }
            }
            
            sendMessage(message) {
                if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                    this.ws.send(JSON.stringify(message));
                } else {
                    this.showAlert('danger', 'WebSocket not connected. Please refresh the page.');
                }
            }
            
            setupEventListeners() {
                // Manual Block Form
                document.getElementById('manualBlockForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const ip = document.getElementById('blockIpAddress').value;
                    const reason = document.getElementById('blockReason').value || 'Manual block';
                    const permanent = document.getElementById('permanentBlock').checked;
                    
                    this.sendMessage({
                        action: 'manual_block',
                        ip_address: ip,
                        reason: reason,
                        permanent: permanent
                    });
                    
                    // Clear form
                    e.target.reset();
                });
                
                // Whitelist Form
                document.getElementById('whitelistForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const ip = document.getElementById('whitelistIpAddress').value;
                    const description = document.getElementById('whitelistDescription').value || 'Added manually';
                    
                    this.sendMessage({
                        action: 'add_whitelist',
                        ip_address: ip,
                        description: description
                    });
                    
                    // Clear form
                    e.target.reset();
                });
            }
            
            updateStats() {
                // Update statistics via API call
                fetch('/api/security-stats/')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('totalBlocked').textContent = data.total_blocked;
                        document.getElementById('activeBlocks').textContent = data.active_blocks;
                        document.getElementById('recentAlerts').textContent = data.recent_alerts;
                        document.getElementById('totalLogs').textContent = data.total_logs;
                    })
                    .catch(error => console.error('Error updating stats:', error));
            }
            
            startStatsUpdater() {
                // Update stats every 30 seconds
                setInterval(() => {
                    this.updateStats();
                }, 30000);
                
                // Initial stats update
                this.updateStats();
            }
            handleSecurityStats(data) {
                const stats = data;
                document.getElementById('totalBlocked').textContent = stats.total_blocked;
                document.getElementById('activeBlocks').textContent = stats.active_blocks;
                document.getElementById('totalLogs').textContent = stats.total_logs;
                document.getElementById('recentAlerts').textContent = stats.recent_alerts;
            }

           
            
            playNotificationSound() {
                // Create a simple beep sound
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            }
        }
        
        // Global functions
        function unblockIP(ip) {
            if (confirm(`Are you sure you want to unblock ${ip}?`)) {
                securityMonitor.sendMessage({
                    action: 'unblock_ip',
                    ip_address: ip
                });
            }
        }
        
        function quickBlock(ip, reason) {
            if (confirm(`Block IP ${ip}?`)) {
                securityMonitor.sendMessage({
                    action: 'manual_block',
                    ip_address: ip,
                    reason: reason || 'Quick block',
                    permanent: false
                });
            }
        }
        
        // Initialize when page loads
        let securityMonitor;
        document.addEventListener('DOMContentLoaded', function() {
            securityMonitor = new SecurityMonitor();
        });
    </script>
{% endblock %}